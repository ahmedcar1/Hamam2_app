
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>تطبيق إدارة الحمام الغزار</title>
    <style>
        body { font-family: Tahoma; margin: 0; background: #eef4ff; }
        header, footer { background: #4CAF50; color: white; text-align: center; padding: 12px; }
        nav { display: flex; justify-content: space-around; background: #333; }
        nav button { flex: 1; padding: 10px; color: white; background: #333; border: none; font-size: 16px; cursor: pointer; }
        nav button:hover { background: #4CAF50; }
        section { display: none; padding: 20px; }
        section.active { display: block; }
        input, textarea, select, button { width: 100%; padding: 10px; margin: 8px 0; font-size: 16px; }
        table { width: 100%; margin-top: 10px; border-collapse: collapse; background: white; }
        th, td { border: 1px solid #aaa; padding: 8px; text-align: center; }
        th { background-color: #cce0ff; }
        .danger { background: #d9534f; color: white; border: none; padding: 5px 10px; cursor: pointer; }
    </style>
</head>
<body>

<header><h1>تطبيق إدارة الحمام الغزار</h1></header>

<nav>
    <button onclick="showPage('main')">الرئيسية</button>
    <button onclick="showPage('production')">الإنتاج والتقييم</button>
    <button onclick="showPage('treatments')">العلاجات</button>
    <button onclick="showPage('vaccinations')">التطعيمات</button>

    <div id="dailyAlert" style="background:#fff3cd;border:1px solid #ffeeba;padding:15px;text-align:center;font-weight:bold;"></div>
</nav>


<section id="main" class="active">
    <h2>إدارة الأزواج</h2>
    <input type="text" id="code" placeholder="اسم/كود الجوز">
    <input type="date" id="entry">
    <textarea id="note" placeholder="ملاحظات"></textarea>
    <button onclick="addMain()">إضافة الجوز</button>
    <table id="mainTable">
        <thead><tr><th>الكود</th><th>التاريخ</th><th>ملاحظات</th><th>حذف</th></tr></thead>
        <tbody></tbody>
    </table>
</section>

<section id="production">
    <h2>الإنتاج والتقييم</h2>
    <select id="prodCode"><option value="">اختر الجوز</option></select>
    <input type="number" id="eggs" placeholder="عدد البيض">
    <input type="number" id="hatched" placeholder="عدد المفقوس">
    <button onclick="addProd()">إضافة</button>
    <table id="prodTable">
        <thead><tr><th>الكود</th><th>البيض</th><th>المفقوس</th><th>التقييم</th><th>حذف</th></tr></thead>
        <tbody></tbody>
    </table>
</section>

<section id="treatments">
    <h2>جدول العلاجات</h2>
    <table>
        <thead><tr><th>الحالة</th><th>الدواء</th><th>الجرعة</th><th>المدة</th></tr></thead>
        <tbody>
            <tr><td>الكنكر</td><td>فلاجيل</td><td>1/8 قرص</td><td>5 أيام</td></tr>
            <tr><td>السالمونيلا</td><td>أمبيسيلين</td><td>1/8 مرتين</td><td>5-7 أيام</td></tr>
            <tr><td>الديدان</td><td>فلوفيرمال</td><td>1 سم</td><td>مرة وتُكرر</td></tr>
        </tbody>
    </table>
</section>

<section id="vaccinations">
    <h2>سجل التطعيمات</h2>
    <select id="vaccCode"><option value="">اختر الجوز</option></select>
    <input type="text" id="vaccineName" placeholder="اسم التطعيم">
    <input type="date" id="vaccineDate">
    <button onclick="addVacc()">إضافة التطعيم</button>
    <table id="vaccTable">
        <thead><tr><th>الكود</th><th>التطعيم</th><th>التاريخ</th><th>حذف</th></tr></thead>
        <tbody></tbody>
    </table>
</section>

<footer>تصميم وتطوير: أحمد خير</footer>

<script>
function showPage(id) {
    document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}

// الرئيسية
function addMain() {
    let code = document.getElementById("code").value.trim();
    let date = document.getElementById("entry").value;
    let note = document.getElementById("note").value.trim();
    if (!code || !date) return alert("يرجى إدخال الكود والتاريخ");

    const data = { id: Date.now(), code, date, note };
    let mains = JSON.parse(localStorage.getItem("mains") || "[]");
    mains.push(data);
    localStorage.setItem("mains", JSON.stringify(mains));
    renderMain(data);

    // تحديث القوائم المنسدلة
    updateDropdowns();

    document.getElementById("code").value = "";
    document.getElementById("entry").value = "";
    document.getElementById("note").value = "";
}

function renderMain(d) {
    let row = document.getElementById("mainTable").querySelector("tbody").insertRow();
    row.innerHTML = `<td>${d.code}</td><td>${d.date}</td><td>${d.note}</td><td><button class='danger' onclick='delMain(${d.id}, this)'>X</button></td>`;
}

function delMain(id, btn) {
    let mains = JSON.parse(localStorage.getItem("mains") || "[]");
    mains = mains.filter(i => i.id !== id);
    localStorage.setItem("mains", JSON.stringify(mains));
    btn.closest("tr").remove();
    updateDropdowns();
}

// الإنتاج والتقييم
function calculateRating(eggs, hatched) {
    if (!eggs || eggs == 0) return "ضعيف";
    const percent = (hatched / eggs) * 100;
    if (percent === 100) return "ممتاز";
    else if (percent >= 50) return "متوسط";
    else return "ضعيف";
}

function addProd() {
    let code = document.getElementById("prodCode").value;
    let eggs = parseInt(document.getElementById("eggs").value);
    let hatched = parseInt(document.getElementById("hatched").value);
    if (!code || isNaN(eggs) || isNaN(hatched)) return alert("يرجى إدخال البيانات");

    let rate = calculateRating(eggs, hatched);
    let data = { id: Date.now(), code, eggs, hatched, rate };

    let prods = JSON.parse(localStorage.getItem("prods") || "[]");
    prods.push(data);
    localStorage.setItem("prods", JSON.stringify(prods));
    renderProd(data);

    document.getElementById("prodCode").value = "";
    document.getElementById("eggs").value = "";
    document.getElementById("hatched").value = "";
}

function renderProd(d) {
    let row = document.getElementById("prodTable").querySelector("tbody").insertRow();
    row.innerHTML = `<td>${d.code}</td><td>${d.eggs}</td><td>${d.hatched}</td><td>${d.rate}</td>
    <td><button class='danger' onclick='delProd(${d.id}, this)'>X</button></td>`;
}

function delProd(id, btn) {
    let prods = JSON.parse(localStorage.getItem("prods") || "[]");
    prods = prods.filter(i => i.id !== id);
    localStorage.setItem("prods", JSON.stringify(prods));
    btn.closest("tr").remove();
}

// التطعيمات
function addVacc() {
    let code = document.getElementById("vaccCode").value;
    let name = document.getElementById("vaccineName").value.trim();
    let date = document.getElementById("vaccineDate").value;
    if (!code || !name || !date) return alert("يرجى إدخال كل البيانات");

    let data = { id: Date.now(), code, name, date };
    let vaccs = JSON.parse(localStorage.getItem("vaccs") || "[]");
    vaccs.push(data);
    localStorage.setItem("vaccs", JSON.stringify(vaccs));
    renderVacc(data);

    document.getElementById("vaccineName").value = "";
    document.getElementById("vaccineDate").value = "";
}

function renderVacc(d) {
    let row = document.getElementById("vaccTable").querySelector("tbody").insertRow();
    row.innerHTML = `<td>${d.code}</td><td>${d.name}</td><td>${d.date}</td><td><button class='danger' onclick='delVacc(${d.id}, this)'>X</button></td>`;
}

function delVacc(id, btn) {
    let vaccs = JSON.parse(localStorage.getItem("vaccs") || "[]");
    vaccs = vaccs.filter(i => i.id !== id);
    localStorage.setItem("vaccs", JSON.stringify(vaccs));
    btn.closest("tr").remove();
}

// تحديث القوائم
function updateDropdowns() {
    const codes = JSON.parse(localStorage.getItem("mains") || "[]").map(m => m.code);
    const selects = [document.getElementById("prodCode"), document.getElementById("vaccCode")];
    selects.forEach(select => {
        select.innerHTML = '<option value="">اختر الجوز</option>';
        codes.forEach(code => {
            let opt = document.createElement("option");
            opt.value = code;
            opt.textContent = code;
            select.appendChild(opt);
        });
    });
}


window.onload = () => {
    showDailyAlert();

    JSON.parse(localStorage.getItem("mains") || "[]").forEach(renderMain);
    JSON.parse(localStorage.getItem("prods") || "[]").forEach(renderProd);
    JSON.parse(localStorage.getItem("vaccs") || "[]").forEach(renderVacc);
    updateDropdowns();
};

function showDailyAlert() {
    const treatments = {
        0: "خل تفاح + ثوم + ليمون",
        1: "فلاجيل + فيتامين C",
        2: "أمبيسيلين + كالسيوم",
        3: "فيتامين E + سيلينيوم",
        4: "راحة / ماء نظيف فقط",
        5: "فلوفيرمال",
        6: "زيت كبد الحوت + عسل"
    };
    const today = new Date().getDay();
    const message = "تنبيه اليوم: " + treatments[today];
    document.getElementById("dailyAlert").textContent = message;

    if (Notification.permission === "granted") {
        new Notification("تنبيه يومي", { body: message });
    } else if (Notification.permission !== "denied") {
        Notification.requestPermission().then(permission => {
            if (permission === "granted") {
                new Notification("تنبيه يومي", { body: message });
            }
        });
    }
}
</script>


</body>
</html>
